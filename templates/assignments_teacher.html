{% extends "base.html" %}

{% block title %}Manage Assignments - TimelyBuddy{% endblock %}

{% block content %}
<style>
    body {
        background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0.1)), url('https://media.istockphoto.com/id/1478140122/photo/3d-calendar-and-alarm-clock-in-cartoon-style-the-concept-of-drawing-up-tasks-and-achieving.jpg?s=612x612&w=0&k=20&c=T-9_C2wufIS4XtH3qQfwoUlGYk008jo0Vj2lEwKkgDs=') no-repeat center center fixed !important;
        background-size: cover !important;
        min-height: 100vh;
    }
    .modern-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.2));
        backdrop-filter: blur(20px);
        border-radius: 20px;
        border: 1px solid rgba(255,255,255,0.3);
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    .assignment-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
        border-radius: 15px;
        border: 1px solid rgba(0,0,0,0.1);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    .assignment-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    .btn-primary {
        background: linear-gradient(45deg, #3b82f6, #1d4ed8);
        border: none;
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
    }
</style>

<div class="row mb-4">
    <div class="col-12">
        <div class="card" style="background: white; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-radius: 10px;">
            <div class="card-body p-4">
                <h2 class="mb-1" style="color: #1e3a8a; font-weight: 700;">
                    <i class="fas fa-clipboard-list me-2"></i>Manage Assignments
                </h2>
                <p class="mb-0" style="color: #6b7280;">Create and manage assignments for your classes</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="modern-card p-4 mb-4">
            <h5 class="mb-4 fw-bold"><i class="fas fa-plus-circle me-2 text-primary"></i>Create New Assignment</h5>
            <form method="POST" action="{{ url_for('create_assignment') }}" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="title" class="form-label fw-semibold">Assignment Title</label>
                    <input type="text" class="form-control" id="title" name="title" required style="border-radius: 10px;">
                </div>
                
                <div class="mb-3">
                    <label for="description" class="form-label fw-semibold">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="3" required style="border-radius: 10px;"></textarea>
                </div>
                
                <div class="mb-3">
                    <label for="subject_id" class="form-label fw-semibold">Subject</label>
                    <select class="form-select" id="subject_id" name="subject_id" required style="border-radius: 10px;">
                        <option value="">Select Subject</option>
                        {% for subject in subjects %}
                        <option value="{{ subject.id }}">{{ subject.name }} ({{ subject.class_name }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="due_date" class="form-label fw-semibold">Due Date</label>
                    <input type="date" class="form-control" id="due_date" name="due_date" required style="border-radius: 10px;">
                </div>
                
                <div class="mb-3">
                    <label for="assignment_file" class="form-label fw-semibold">Assignment File</label>
                    <input type="file" class="form-control" id="assignment_file" name="assignment_file" accept=".pdf,.doc,.docx,.txt" required style="border-radius: 10px;">
                    <small class="text-muted">Upload PDF, DOC, DOCX, or TXT files</small>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-plus me-2"></i>Create Assignment
                </button>
            </form>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="modern-card p-4">
            <h5 class="mb-4 fw-bold"><i class="fas fa-list me-2 text-success"></i>My Assignments</h5>
            
            {% if assignments %}
                <div class="row">
                    {% for assignment in assignments %}
                    <div class="col-12 mb-3">
                        <div class="assignment-card p-4">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="fw-bold mb-2" style="color: #1e3a8a;">{{ assignment.title }}</h6>
                                    <p class="text-muted mb-2">{{ assignment.description }}</p>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <i class="fas fa-book me-1"></i>
                                                <strong>Subject:</strong> {{ assignment.subject_name }}
                                            </small>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <i class="fas fa-school me-1"></i>
                                                <strong>Class:</strong> {{ assignment.class_name }}
                                            </small>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <i class="fas fa-calendar me-1"></i>
                                                <strong>Due:</strong> {{ assignment.due_date }}
                                            </small>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <i class="fas fa-users me-1"></i>
                                                <strong>Submissions:</strong> {{ assignment.submission_count }}/{{ assignment.total_students }}
                                            </small>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <a href="{{ url_for('view_submissions', assignment_id=assignment.id) }}" class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-eye me-1"></i>View Submissions
                                        </a>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    {% set due_date = assignment.due_date %}
                                    {% if due_date < today %}
                                        <span class="badge bg-danger">Overdue</span>
                                    {% elif due_date == today %}
                                        <span class="badge bg-warning">Due Today</span>
                                    {% else %}
                                        <span class="badge bg-success">Active</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-clipboard-list fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">No assignments created yet</h5>
                    <p class="text-muted">Create your first assignment using the form on the left</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Set minimum date to today for due date input
document.addEventListener('DOMContentLoaded', function() {
    const dueDateInput = document.getElementById('due_date');
    const today = new Date().toISOString().split('T')[0];
    dueDateInput.min = today;
});
</script>
{% endblock %}